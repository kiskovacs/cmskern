<!-- Select one existing articles -->
<h3>Select Node</h3>

<ul>
#{list items: nodes, as:'node'}
    <li><a href="#"
           onclick="updateNodeRef('${node._id}', '${node.data.title}', '${node.data.ancestors_idref}')">${node.data.title}</a>
        (Path: ${node.data.path}, Parent: ${node.data.parent})
    </li>
#{/list}
</ul>


<fieldset>
    <label for="select_id">Node ID</label>
    <input type="text" id="select_id" name="value" value="${fields['id'].value}" readonly="readonly" />

    <label for="select_title">Title</label>
    <input type="text" id="select_title" name="title" value="${fields['title'].value}" />
    <label for="select_title">Title</label>
    <input type="text" id="select_ancestors" name="title" value="${fields['ancestors'].value}" />
</fieldset>


<script type="text/javascript">
    var selectedId    = -1;
    var selectedTitle = "";
    var selectedAncestors = "";

    $(function() {
        selectedId = $('#select_id').val();
        selectedTitle = $('#select_title').val();
        selectedAncestors = $('#select_ancestors').val() + ',' + selectedId;
    });

    function updateNodeRef(val, title, ancestors) {
        console.log("updateNodeRefe(" + val + ", "+ title + ", " + ancestors);
        selectedId = val;
        $("#select_id").val(val);
        selectedTitle = title;
        $("#select_title").val(title);

        selectedAncestors = selectedId;
        if (ancestors) {
            selectedAncestors = selectedAncestors + ',' + ancestors;
        }
        $("#select_ancestors").val(ancestors);

    }

    $("#select_title").on("change", function(event) {
        event.preventDefault();
        selectedTitle = $(this).val();
    });

    // contract: returns [ID, TITLE]
    function calloutGetSelectedValues() {
        return {
            '${fields['id'].targetFQName}': selectedId,
            '${fields['title'].targetFQName}': selectedTitle,
            '${fields['ancestors'].targetFQName}': selectedAncestors
        };
    }
</script>
