<!-- Select one of the existing images or TODO: create a new one (on-the-fly) -->

<h3>Select Image</h3>

<ul>
#{list items: images, as:'image'}
    <li><a href="#" onclick="updateRef('${image._id}', '${image.data.title}')">${image.data.title}</a></li>
#{/list}
</ul>


<fieldset>
    <label for="select_value">Image ID</label>
    <input type="text" id="select_value" name="value" value="" readonly="readonly" />

    <label for="select_title">Title</label>
    <input type="text" id="select_title" name="title" value="" />
</fieldset>


<script type="text/javascript">

    var temp = Array();
    // contract: returns [ID, TITLE]

    // we need to hold the values in a separate variable, otherwise data is lost when the dialog is closed
    var selectedValue = "";
    var selectedTitle = "";

    function updateRef(val, title) {
    temp[0] = val;
    temp[1] = title;

        selectedValue = val;
        $("#select_value").val(val);
        selectedTitle = title;
        $("#select_title").val(title);
    }

    $("#select_title").on("change", function(event) {
        event.preventDefault();
        selectedTitle = $(this).val();
    });

    // Contract between Caller and Callout
    function calloutGetSelectedValues() {
        var params = Array('${(fieldnames as String[]).join('\',\'')}');
        var result = {};
        for (idx in params) {
            if (params[idx] && "" !== params[idx]) {
                result[params[idx]] = temp[idx];
            }
        }
        return result;
    }

</script>